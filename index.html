<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¬¸ì œì •ì˜ ì•„í‚¤íƒ€ì… ì§„ë‹¨ (Preview)</title>

  <!-- React & Libraries (Stable Version for Standalone) -->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/history@5/umd/history.production.min.js"></script>
  <!-- React Router v5 -->
  <script src="https://unpkg.com/react-router-dom@5.3.4/umd/react-router-dom.min.js"></script>
  <script src="https://unpkg.com/framer-motion@4.1.17/dist/framer-motion.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- External Data -->
  <script src="src/data/questions.js"></script>
  <script src="src/data/archetypes.js"></script>

  <style>
    /* CSS Variables */
    :root {
      --color-bg: #FAFAFA;
      --color-surface: #FFFFFF;
      --color-text-main: #222222;
      --color-text-sub: #4A4A4A;
      --color-text-muted: #888888;
      --color-accent: #3344DD;
      --color-accent-subtle: #EBEFFE;
      --color-border: #EEEEEE;
      --color-card-bg: #F5F5F7;
      --font-main: -apple-system, BlinkMacSystemFont, "Pretendard", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;

      --max-width: 460px;
    }

    /* Global Reset & Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: var(--font-main);
      background-color: var(--color-bg);
      color: var(--color-text-main);
      line-height: 1.6;
    }

    #root {
      display: flex;
      justify-content: center;
      min-height: 100vh;
      width: 100%;
    }

    .app-container {
      width: 100%;
      max-width: var(--max-width);
      background-color: var(--color-surface);
      min-height: 100vh;
      position: relative;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.03);
    }

    /* Typography */
    .text-h1 {
      font-size: 26px;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: var(--space-4);
      letter-spacing: -0.02em;
    }

    .text-h2 {
      font-size: 20px;
      font-weight: 600;
      line-height: 1.35;
      margin-bottom: var(--space-3);
      letter-spacing: -0.01em;
    }

    .text-h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: var(--space-2);
      color: var(--color-text-main);
    }

    .text-body {
      font-size: 16px;
      color: var(--color-text-sub);
      margin-bottom: var(--space-3);
      word-break: keep-all;
    }

    .text-small {
      font-size: 14px;
      color: var(--color-text-muted);
    }

    button {
      border: none;
      background: none;
      font-family: inherit;
      cursor: pointer;
    }

    .screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: var(--space-6);
      padding-bottom: var(--space-10);
    }

    /* Markdown-like content styling 
       UPDATED: Removed explicit colors to allow inheritance for 'highlight' mode */
    .content-block h3 {
      font-size: 16px;
      font-weight: 700;
      margin-top: 24px;
      margin-bottom: 8px;
      color: inherit;
    }

    .content-block p {
      font-size: 15px;
      line-height: 1.65;
      margin-bottom: 12px;
      color: inherit;
      opacity: 0.95;
    }

    .content-block ul {
      padding-left: 20px;
      margin-bottom: 16px;
    }

    .content-block li {
      margin-bottom: 6px;
      font-size: 15px;
    }

    .content-block strong {
      font-weight: 600;
      color: inherit;
    }

    .container {
      width: 100%;
      padding: var(--space-6);
      max-width: var(--max-width);
      margin: 0 auto;
    }

    .content-block h3 {
      font-size: 1.1rem;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--color-accent);
    }

    .content-block p {
      margin-bottom: 1rem;
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { HashRouter, Switch, Route, useHistory, useLocation } = ReactRouterDOM;
    const { motion, AnimatePresence } = window.Motion;

    // --- DATA ---
    const questions = window.questions;
    const archetypes = window.archetypes;

    const archetypeIcons = {
      'Anthropologist': 'ğŸ”',
      'Journalist': 'ğŸ“°',
      'Detective': 'ğŸ•µï¸',
      'Systems Thinker': 'ğŸŒ',
      'Cartographer': 'ğŸ—ºï¸',
      'Philosopher': 'ğŸ’­',
      'Scientist': 'ğŸ”¬',
      'Economist': 'ğŸ’°',
      'Scenario Planner': 'ğŸ¯',
      'Judge': 'âš–ï¸'
    };

    const calculateResults = (answers) => {
      const archetypeCounts = {};
      const archetypeSums = {};

      archetypes.forEach(a => {
        archetypeCounts[a.id] = 0;
        archetypeSums[a.id] = 0;
      });

      questions.forEach(q => {
        if (archetypeCounts.hasOwnProperty(q.archetype)) {
          archetypeCounts[q.archetype]++;
        }
      });

      Object.entries(answers).forEach(([qId, value]) => {
        const q = questions.find(q => q.id === Number(qId));
        if (q && archetypeSums.hasOwnProperty(q.archetype)) {
          archetypeSums[q.archetype] += value;
        }
      });

      const scores = {};
      Object.keys(archetypeSums).forEach(id => {
        const count = archetypeCounts[id];
        if (count > 0) {
          scores[id] = Math.round((archetypeSums[id] / (count * 5)) * 100);
        } else {
          scores[id] = 0;
        }
      });

      const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);

      const activeArchetypes = sorted.filter(s => s[1] >= 80).map(s => s[0]);
      const inactiveArchetypes = sorted.filter(s => s[1] <= 40).map(s => s[0]);

      return {
        activeArchetypes,
        inactiveArchetypes,
        allScores: sorted
      };
    };

    // --- COMPONENTS ---
    const LandingPage = () => {
      const history = useHistory();
      const [name, setName] = useState(localStorage.getItem('archetype_user_name') || '');

      const handleStart = () => {
        if (!name.trim()) {
          alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        localStorage.setItem('archetype_user_name', name.trim());
        history.push('/intro');
      };

      return (
        <div className="screen" style={{ justifyContent: 'center', background: 'linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%)' }}>
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, ease: "easeOut" }}
            style={{ textAlign: 'center', width: '100%', maxWidth: '400px', margin: '0 auto' }}
          >
            <motion.div
              initial={{ scale: 0.9 }}
              animate={{ scale: 1 }}
              transition={{ duration: 1, ease: "easeOut" }}
              style={{
                width: '80px',
                height: '80px',
                margin: '0 auto 32px',
                background: 'linear-gradient(135deg, var(--color-accent) 0%, #5a8fb8 100%)',
                borderRadius: '20px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                boxShadow: '0 10px 30px rgba(69, 123, 157, 0.3)'
              }}
            >
              <span style={{ fontSize: '40px' }}>ğŸ§­</span>
            </motion.div>

            <h1 className="text-h1" style={{ marginBottom: '24px', fontSize: '28px', lineHeight: '1.4' }}>
              ë¬¸ì œë¥¼ í‘¸ëŠ” ëŠ¥ë ¥ë³´ë‹¤,<br />
              <span style={{ color: 'var(--color-accent)', fontWeight: 700 }}>ë¬¸ì œë¥¼ ì •ì˜í•˜ëŠ” ë°©ì‹</span>ì´<br />
              ê²°ê³¼ë¥¼ ë°”ê¿‰ë‹ˆë‹¤.
            </h1>

            <div style={{ marginBottom: '32px', background: 'rgba(255,255,255,0.8)', padding: '24px', borderRadius: '12px', backdropFilter: 'blur(10px)' }}>
              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '14px', color: '#666', marginBottom: '8px', textAlign: 'left' }}>ì„±í•¨ì„ ì•Œë ¤ì£¼ì„¸ìš”</label>
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  placeholder="ì˜ˆ: í™ê¸¸ë™"
                  style={{
                    width: '100%',
                    padding: '16px',
                    borderRadius: '8px',
                    border: '1px solid #ddd',
                    fontSize: '16px',
                    outline: 'none',
                    textAlign: 'center'
                  }}
                />
              </div>
              <p className="text-body" style={{ marginBottom: '16px', fontSize: '15px' }}>
                ì´ í…ŒìŠ¤íŠ¸ëŠ” ë‹¹ì‹ ì´ ë¬¸ì œì— ì§ë©´í–ˆì„ ë•Œ<br />
                <strong style={{ color: 'var(--color-accent)' }}>ê°€ì¥ ë¨¼ì € êº¼ë‚´ ë“œëŠ” ì‚¬ê³  ë„êµ¬</strong>ë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤.
              </p>
              <div style={{ display: 'flex', gap: '8px', justifyContent: 'center', flexWrap: 'wrap' }}>
                <span style={{ padding: '4px 12px', background: '#f0f4f8', borderRadius: '20px', fontSize: '12px', color: '#555' }}>â±ï¸ 5ë¶„ ì†Œìš”</span>
                <span style={{ padding: '4px 12px', background: '#f0f4f8', borderRadius: '20px', fontSize: '12px', color: '#555' }}>ğŸ“Š {questions.length}ë¬¸í•­</span>
              </div>
            </div>

            <button
              onClick={handleStart}
              disabled={!name.trim()}
              style={{
                width: '100%',
                padding: '20px',
                background: name.trim() ? 'linear-gradient(135deg, var(--color-accent) 0%, #5a8fb8 100%)' : '#ccc',
                color: '#fff',
                borderRadius: '12px',
                fontSize: '17px',
                fontWeight: 600,
                boxShadow: name.trim() ? '0 4px 15px rgba(69, 123, 157, 0.3)' : 'none',
                border: 'none',
                cursor: name.trim() ? 'pointer' : 'default',
                transition: 'all 0.2s'
              }}
            >
              ğŸš€ ì‹œì‘í•˜ê¸°
            </button>
          </motion.div>
        </div>
      );
    };

    const IntroPage = () => {
      const history = useHistory();
      return (
        <div className="screen" style={{ background: 'linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%)' }}>
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.6 }}>
            <div style={{ height: '20px' }}></div>
            <h2 className="text-h2" style={{ textAlign: 'center', marginBottom: '32px', fontSize: '24px' }}>ì‹œì‘í•˜ê¸° ì „ì— ğŸ“‹</h2>

            <div style={{ background: 'linear-gradient(135deg, #eef2f7 0%, #ffffff 100%)', padding: '28px', borderRadius: '16px', marginBottom: '24px', border: '1px solid #e0e7ef', boxShadow: '0 4px 12px rgba(0,0,0,0.05)' }}>
              <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: 'var(--color-accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', marginRight: '12px' }}>
                  <span style={{ fontSize: '20px' }}>âœï¸</span>
                </div>
                <p style={{ fontWeight: 700, fontSize: '17px', margin: 0, color: '#222' }}>ì°¸ì—¬ ê°€ì´ë“œ</p>
              </div>
              <ul style={{ paddingLeft: '0', listStyle: 'none', lineHeight: '2' }}>
                <li style={{ display: 'flex', alignItems: 'flex-start', marginBottom: '12px' }}>
                  <span style={{ fontSize: '20px', marginRight: '12px' }}>âš¡</span>
                  <span className="text-body">ìƒê°ì„ ë©ˆì¶”ì§€ ë§ê³  <strong style={{ color: 'var(--color-accent)' }}>ì§ê´€ì </strong>ìœ¼ë¡œ ë‹µí•˜ì„¸ìš”</span>
                </li>
                <li style={{ display: 'flex', alignItems: 'flex-start', marginBottom: '12px' }}>
                  <span style={{ fontSize: '20px', marginRight: '12px' }}>ğŸ’¼</span>
                  <span className="text-body">êµ¬ì²´ì ì¸ <strong style={{ color: 'var(--color-accent)' }}>ìµœê·¼ í”„ë¡œì íŠ¸</strong>ë¥¼ ë– ì˜¬ë¦¬ì„¸ìš”</span>
                </li>
                <li style={{ display: 'flex', alignItems: 'flex-start' }}>
                  <span style={{ fontSize: '20px', marginRight: '12px' }}>ğŸ¯</span>
                  <span className="text-body">'ì´ìƒì ì¸ ëª¨ìŠµ'ì´ ì•„ë‹Œ <strong style={{ color: 'var(--color-accent)' }}>'ì‹¤ì œ ëª¨ìŠµ'</strong>ì— ì²´í¬í•˜ì„¸ìš”</span>
                </li>
              </ul>
            </div>

            <div style={{ background: '#fff9e6', padding: '16px', borderRadius: '12px', marginBottom: '32px', border: '1px solid #ffe4a3' }}>
              <p style={{ fontSize: '14px', margin: 0, color: '#856404', lineHeight: '1.6' }}>
                ğŸ’¡ <strong>Tip:</strong> ì •ë‹µì€ ì—†ìŠµë‹ˆë‹¤. í‰ì†Œ ë‹¹ì‹ ì˜ ëª¨ìŠµì„ ì†”ì§í•˜ê²Œ í‘œí˜„í•´ì£¼ì„¸ìš”.
              </p>
            </div>

            <button
              onClick={() => history.push('/test')}
              style={{
                width: '100%',
                padding: '20px',
                background: 'linear-gradient(135deg, var(--color-accent) 0%, #5a8fb8 100%)',
                color: '#fff',
                borderRadius: '12px',
                fontWeight: 600,
                fontSize: '17px',
                border: 'none',
                cursor: 'pointer',
                boxShadow: '0 4px 15px rgba(69, 123, 157, 0.3)',
                transition: 'transform 0.2s'
              }}
              onMouseEnter={(e) => e.currentTarget.style.transform = 'translateY(-2px)'}
              onMouseLeave={(e) => e.currentTarget.style.transform = 'none'}
            >
              ğŸš€ í…ŒìŠ¤íŠ¸ ì§„í–‰í•˜ê¸°
            </button>
          </motion.div>
        </div>
      );
    };

    const TestPage = () => {
      const history = useHistory();
      const [index, setIndex] = useState(() => {
        try {
          const saved = localStorage.getItem('archetype_progress');
          if (saved) {
            const parsed = JSON.parse(saved);
            if (parsed && typeof parsed === 'object' && typeof parsed.index === 'number') {
              return parsed.index >= questions.length ? 0 : parsed.index;
            }
          }
        } catch (e) {
          console.error("Failed to parse progress", e);
        }
        return 0;
      });
      const [answers, setAnswers] = useState(() => {
        try {
          const saved = localStorage.getItem('archetype_progress');
          if (saved) {
            const parsed = JSON.parse(saved);
            if (parsed && typeof parsed === 'object' && parsed.answers) {
              return parsed.answers;
            }
          }
        } catch (e) {
          console.error("Failed to parse answers", e);
        }
        return {};
      });
      const [isFinishing, setIsFinishing] = useState(false);

      // Save progress whenever it changes
      useEffect(() => {
        if (!isFinishing) {
          localStorage.setItem('archetype_progress', JSON.stringify({ index, answers }));
        }
      }, [index, answers, isFinishing]);

      const currentQuestion = questions[index] || questions[0];
      const progress = ((index) / questions.length) * 100;

      const handleAnswer = (val) => {
        const newAnswers = { ...answers, [currentQuestion.id]: val };
        setAnswers(newAnswers);

        // Wait for animation
        setTimeout(() => {
          if (index < questions.length - 1) {
            setIndex(prev => {
              const next = prev + 1;
              return next < questions.length ? next : prev;
            });
          } else {
            finishTest(newAnswers);
          }
        }, 300);
      };

      const finishTest = async (finalAnswers) => {
        setIsFinishing(true);
        const name = localStorage.getItem('archetype_user_name');
        const results = calculateResults(finalAnswers);

        try {
          await fetch('/api/save-result', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              name,
              answers: finalAnswers,
              scores: results.allScores,
              timestamp: new Date().toISOString()
            })
          });
        } catch (e) {
          console.error("Failed to save results", e);
        }

        setTimeout(() => {
          localStorage.setItem('archetype_answers', JSON.stringify(finalAnswers));
          localStorage.removeItem('archetype_progress');
          history.push('/result');
        }, 1500);
      };

      const getRound = () => {
        if (index < 14) return { title: "Round 1: ë°œê²¬ê³¼ íƒìƒ‰", desc: "í˜„ìƒì˜ ê´€ì°°ê³¼ ë¬¸ì œì˜ ë²”ìœ„ë¥¼ ì„¤ì •í•˜ëŠ” ì´ˆê¸° ë‹¨ê³„" };
        if (index < 27) return { title: "Round 2: ì‹¬ì¸µ í•´ì„ê³¼ í†µì°°", desc: "ë³´ì´ì§€ ì•ŠëŠ” êµ¬ì¡°ì™€ ë§¥ë½ì„ íŒŒì•…í•˜ê³  ì˜ì‹¬í•˜ëŠ” ë‹¨ê³„" };
        return { title: "Round 3: í˜„ì‹¤ ê²€ì¦ê³¼ ê²°ë‹¨", desc: "ì‹¤í–‰ ê°€ëŠ¥ì„±ì„ ë”°ì§€ê³  ìµœì¢…ì ì¸ ê°€ì¹˜ë¥¼ íŒë‹¨í•˜ëŠ” ë§ˆë¬´ë¦¬ ë‹¨ê³„" };
      };
      const round = getRound();

      if (isFinishing) return (
        <div className="screen" style={{ justifyContent: 'center', alignItems: 'center' }}>
          <p className="text-body" style={{ opacity: 0.6 }}>ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
      );

      return (
        <div className="screen" style={{ display: 'flex', flexDirection: 'column' }}>
          <div style={{ marginBottom: '24px', textAlign: 'center' }}>
            <span style={{ fontSize: '12px', color: 'var(--color-accent)', fontWeight: 700, letterSpacing: '1px', textTransform: 'uppercase' }}>{round.title}</span>
            <div style={{ fontSize: '14px', color: '#666', marginTop: '4px' }}>{round.desc}</div>
          </div>
          <div style={{ width: '100%', height: '6px', background: '#f0f0f0', marginBottom: '32px', borderRadius: '3px', overflow: 'hidden' }}>
            <motion.div
              style={{ height: '100%', background: 'linear-gradient(90deg, var(--color-accent) 0%, #5a8fb8 100%)' }}
              initial={{ width: 0 }}
              animate={{ width: `${progress}%` }}
              transition={{ duration: 0.3 }}
            />
          </div>
          <div style={{ position: 'relative', flex: 1, width: '100%' }}>
            <AnimatePresence>
              <motion.div
                key={index}
                initial={{ opacity: 0, x: 20 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: -20 }}
                transition={{ duration: 0.3 }}
                style={{
                  position: 'absolute',
                  top: 0,
                  left: 0,
                  width: '100%',
                  height: '100%',
                  display: 'flex',
                  flexDirection: 'column',
                  backgroundColor: 'var(--color-surface)'
                }}
              >
                <div style={{ flex: 1, display: 'flex', flexDirection: 'column', justifyContent: 'center', padding: '0 0 40px 0' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '24px' }}>
                    <div>
                      <span className="text-small" style={{ color: 'var(--color-accent)', marginBottom: '8px', display: 'block', fontWeight: 600 }}>QUESTION {index + 1} / {questions.length}</span>
                      <div style={{ width: '60px', height: '3px', background: 'linear-gradient(90deg, var(--color-accent) 0%, #5a8fb8 100%)', borderRadius: '2px' }}></div>
                    </div>
                    {index > 0 && (
                      <button
                        onClick={() => setIndex(prev => prev - 1)}
                        style={{
                          background: '#f0f0f0',
                          border: 'none',
                          color: '#666',
                          fontSize: '12px',
                          fontWeight: 600,
                          cursor: 'pointer',
                          padding: '6px 12px',
                          borderRadius: '20px',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '4px',
                          transition: 'background 0.2s'
                        }}
                        onMouseEnter={(e) => e.currentTarget.style.background = '#e0e0e0'}
                        onMouseLeave={(e) => e.currentTarget.style.background = '#f0f0f0'}
                      >
                        â† ì´ì „
                      </button>
                    )}
                  </div>
                  <h2 className="text-h1" style={{ fontSize: '20px', lineHeight: '1.6', marginBottom: '0' }}>{currentQuestion.text}</h2>
                </div>
                <div style={{ marginBottom: '20px', background: '#f8f9fa', padding: '24px', borderRadius: '12px' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '16px' }}>
                    {[1, 2, 3, 4, 5].map((val) => (
                      <button
                        key={val}
                        onClick={() => handleAnswer(val)}
                        style={{
                          width: '52px',
                          height: '52px',
                          borderRadius: '50%',
                          background: '#fff',
                          border: '2px solid #e0e0e0',
                          boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                          cursor: 'pointer',
                          transition: 'all 0.2s',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center'
                        }}
                        onMouseEnter={(e) => { e.currentTarget.style.transform = 'scale(1.1)'; e.currentTarget.style.borderColor = 'var(--color-accent)'; }}
                        onMouseLeave={(e) => { e.currentTarget.style.transform = 'scale(1)'; e.currentTarget.style.borderColor = '#e0e0e0'; }}
                      >
                        <div style={{
                          width: val === 1 || val === 5 ? '16px' : val === 2 || val === 4 ? '12px' : '8px',
                          height: val === 1 || val === 5 ? '16px' : val === 2 || val === 4 ? '12px' : '8px',
                          background: val === 5 ? '#888' : val === 1 ? '#ccc' : '#ddd',
                          borderRadius: '50%'
                        }}></div>
                      </button>
                    ))}
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', paddingTop: '8px' }}>
                    <span className="text-small" style={{ color: '#666', fontSize: '13px' }}>ì „í˜€ ì•„ë‹ˆë‹¤</span>
                    <span className="text-small" style={{ color: '#666', fontSize: '13px' }}>ë§¤ìš° ê·¸ë ‡ë‹¤</span>
                  </div>
                </div>
              </motion.div>
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const RadarChart = ({ data, size = 300 }) => {
      // Safety Check
      if (!data || data.length === 0) return null;

      const radius = size / 2;
      const center = size / 2;
      const angleStep = (Math.PI * 2) / data.length;

      const safeMaxScore = 100; // Fixed scale for percentage
      const scaleFactor = (radius - 60) / safeMaxScore;

      const points = data.map(([id, score], i) => {
        const angle = i * angleStep - Math.PI / 2;
        const r = score * scaleFactor;
        return [
          center + r * Math.cos(angle),
          center + r * Math.sin(angle)
        ];
      }).join(' ');

      const outerPoints = data.map((_, i) => {
        const angle = i * angleStep - Math.PI / 2;
        const r = radius - 60;
        return [
          center + r * Math.cos(angle),
          center + r * Math.sin(angle)
        ];
      });

      return (
        <div style={{ display: 'flex', justifyContent: 'center', margin: '40px 0' }}>
          <svg width={size} height={size} style={{ overflow: 'visible' }}>
            {/* Background Grid (Pentagons/Decagons) */}
            {[0.2, 0.4, 0.6, 0.8, 1].map(scale => (
              <polygon
                key={scale}
                points={outerPoints.map(([x, y]) => {
                  const dx = x - center; const dy = y - center;
                  return `${center + dx * scale},${center + dy * scale} `;
                }).join(' ')}
                fill="none"
                stroke="#eee"
                strokeWidth="1"
              />
            ))}

            {/* Axes */}
            {outerPoints.map(([x, y], i) => (
              <line key={i} x1={center} y1={center} x2={x} y2={y} stroke="#eee" strokeWidth="1" />
            ))}

            {/* Data Area */}
            <polygon points={points} fill="rgba(69, 123, 157, 0.2)" stroke="var(--color-accent)" strokeWidth="2" />

            {/* Scale Labels (20%, 40%, 60%, 80%, 100%) */}
            {[0.2, 0.4, 0.6, 0.8, 1].map(scale => (
              <text
                key={scale}
                x={center}
                y={center - (radius - 60) * scale}
                textAnchor="middle"
                fontSize="10"
                fill="#ccc"
                dominantBaseline="middle"
              >
                {Math.round(scale * 100)}%
              </text>
            ))}

            {/* Data Points */}
            {points.split(' ').map((p, i) => {
              const [x, y] = p.split(',');
              return <circle key={i} cx={x} cy={y} r="3" fill="var(--color-accent)" />
            })}

            {/* Labels */}
            {data.map(([id, score], i) => {
              const angle = i * angleStep - Math.PI / 2;
              const r = radius - 30; // Push labels out
              const x = center + r * Math.cos(angle);
              const y = center + r * Math.sin(angle);
              const arch = archetypes.find(a => a.id === id);
              return (
                <g key={id}>
                  <text
                    x={x}
                    y={y - 8}
                    textAnchor="middle"
                    dominantBaseline="middle"
                    fill="#666"
                    fontSize="11"
                    fontWeight="600"
                  >
                    {arch.name.split(' (')[0]}
                  </text>
                  <text
                    x={x}
                    y={y + 6}
                    textAnchor="middle"
                    dominantBaseline="middle"
                    fill="var(--color-accent)"
                    fontSize="10"
                    fontWeight="700"
                  >
                    {score}%
                  </text>
                </g>
              );
            })}
          </svg>
        </div>
      );
    };

    const ResultCard = ({ archetype, label, subLabel, delay, highlight, isUnderUsed, score }) => {
      const [expanded, setExpanded] = useState(false);
      if (!archetype) return null;
      return (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay, duration: 0.6 }}
          style={{ background: highlight ? 'var(--color-accent)' : 'var(--color-card-bg)', color: highlight ? '#fff' : 'inherit', padding: '24px', borderRadius: '4px', marginBottom: '16px', cursor: 'pointer', borderLeft: isUnderUsed ? '4px solid #999' : 'none' }}
          onClick={() => setExpanded(!expanded)}
        >
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <span className="text-small" style={{ textTransform: 'uppercase', color: highlight ? 'rgba(255,255,255,0.7)' : '#888' }}>{label}</span>
                <span style={{ fontSize: '12px', fontWeight: 700, background: highlight ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.05)', padding: '2px 8px', borderRadius: '10px' }}>{score}%</span>
              </div>
              <h3 className="text-h2" style={{ marginTop: '8px', fontSize: '24px' }}>{archetype.name.split(' (')[0]}</h3>
              <p style={{ opacity: 0.9, fontSize: '15px' }}>{archetype.oneLiner}</p>
            </div>
            <div style={{ fontSize: '24px' }}>{archetypeIcons[archetype.id]}</div>
          </div>
          <AnimatePresence>
            {expanded && (
              <motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }} exit={{ height: 0, opacity: 0 }} style={{ overflow: 'hidden' }}>
                <div style={{ paddingTop: '24px', marginTop: '24px', borderTop: highlight ? '1px solid rgba(255,255,255,0.2)' : '1px solid #eee' }}>
                  <div style={{ marginBottom: '24px' }}>
                    <p style={{ fontSize: '15px', lineHeight: '1.6' }}>{archetype.desc}</p>
                  </div>

                  {/* Full Content Block injected via HTML */}
                  <div className="content-block" dangerouslySetInnerHTML={{ __html: archetype.fullContent }} style={{ color: highlight ? 'rgba(255,255,255,0.95)' : 'inherit' }} />

                  <div style={{ background: highlight ? 'rgba(0,0,0,0.2)' : 'rgba(0,0,0,0.05)', padding: '16px', borderRadius: '4px', marginTop: '24px' }}>
                    <strong style={{ display: 'block', marginBottom: '8px', color: highlight ? '#fff' : 'var(--color-accent)' }}>âš ï¸ Blind Spot</strong>
                    <p style={{ fontSize: '14px', margin: 0, color: highlight ? 'rgba(255,255,255,0.9)' : '#555' }}>{archetype.blindSpot}</p>
                  </div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </motion.div>
      );
    }

    const ResultPage = () => {
      const history = useHistory();
      const [results, setResults] = useState(null);
      const [stats, setStats] = useState(null);
      const [statsError, setStatsError] = useState(null);
      const userName = localStorage.getItem('archetype_user_name') || 'ë°©ë¬¸ì';

      useEffect(() => {
        const saved = localStorage.getItem('archetype_answers');
        if (saved) {
          setResults(calculateResults(JSON.parse(saved)));
        }

        fetch('/api/get-stats')
          .then(res => {
            if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
            return res.json();
          })
          .then(data => {
            if (data.error) throw new Error(data.error);
            setStats(data);
          })
          .catch(err => {
            console.error("Failed to fetch stats", err);
            setStatsError(err.message);
          });
      }, []);

      if (!results) return (
        <div className="screen" style={{ justifyContent: 'center', alignItems: 'center' }}>
          <p className="text-body" style={{ opacity: 0.6 }}>ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
          <button className="btn-secondary" onClick={() => window.location.hash = '#/'} style={{ marginTop: '20px' }}>í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      );

      const activeList = results.activeArchetypes.map(id => ({
        ...archetypes.find(a => a.id === id),
        score: results.allScores.find(s => s[0] === id)[1]
      }));

      const inactiveList = results.inactiveArchetypes.map(id => ({
        ...archetypes.find(a => a.id === id),
        score: results.allScores.find(s => s[0] === id)[1]
      }));

      const primary = archetypes.find(a => a.id === (results.allScores[0] ? results.allScores[0][0] : '')) || archetypes[0];
      const secondary = archetypes.find(a => a.id === (results.allScores[1] ? results.allScores[1][0] : '')) || archetypes[1];
      const underUsed = archetypes.find(a => a.id === (results.allScores[results.allScores.length - 1] ? results.allScores[results.allScores.length - 1][0] : '')) || archetypes[archetypes.length - 1];

      return (
        <div className="screen">
          <div style={{ textAlign: 'center', marginBottom: '40px' }}>
            <h2 className="text-h1" style={{ marginBottom: '8px' }}>{userName}ë‹˜ì˜ ì§„ë‹¨ ê²°ê³¼</h2>
            <p className="text-body">ì´ ê²°ê³¼ëŠ” ê³ ì •ëœ ì„±í–¥ì´ ì•„ë‹ˆë¼<br />ì§€ê¸ˆ ì´ ì‹œì ì—ì„œ ìì£¼ í™œìš©ëœ ì‚¬ê³  ë°©ì‹ì…ë‹ˆë‹¤.</p>
          </div>

          <section style={{ marginBottom: '48px' }}>
            <h3 className="text-h2" style={{ marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
              ğŸ”¥ í™œì„± ì•„í‚¤íƒ€ì… <span style={{ fontSize: '14px', fontWeight: 500, color: '#666' }}>({activeList.length})</span>
            </h3>
            {activeList.length > 0 ? (
              activeList.map((a, i) => (
                <ResultCard key={a.id} archetype={a} label="ACTIVE" score={a.score} delay={i * 0.1} highlight />
              ))
            ) : (
              <p style={{ color: '#999', fontSize: '14px', padding: '20px', textAlign: 'center', border: '1px dashed #ddd', borderRadius: '8px' }}>ê°•ë ¥í•˜ê²Œ í™œì„±í™”ëœ ìœ í˜•ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            )}
          </section>

          <section style={{ marginBottom: '48px' }}>
            <h3 className="text-h2" style={{ marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
              â„ï¸ ë¹„í™œì„± ì•„í‚¤íƒ€ì… <span style={{ fontSize: '14px', fontWeight: 500, color: '#666' }}>({inactiveList.length})</span>
            </h3>
            {inactiveList.length > 0 ? (
              inactiveList.map((a, i) => (
                <ResultCard key={a.id} archetype={a} label="INACTIVE" score={a.score} delay={0.3 + i * 0.1} isUnderUsed />
              ))
            ) : (
              <p style={{ color: '#999', fontSize: '14px', padding: '20px', textAlign: 'center', border: '1px dashed #ddd', borderRadius: '8px' }}>ëª¨ë“  ìœ í˜•ì´ ì–´ëŠ ì •ë„ í™œìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
            )}
          </section>

          <div style={{ marginTop: '50px' }}>
            <AnalysisSection
              primary={primary}
              secondary={secondary}
              underUsed={underUsed}
              allScores={results.allScores}
              rawAnswers={JSON.parse(localStorage.getItem('archetype_answers'))}
            />
          </div>

          {stats ? (
            <div style={{ marginTop: '60px' }}>
              <StatisticsSection stats={stats} userPrimaryId={primary.id} />
            </div>
          ) : statsError ? (
            <div style={{ marginTop: '60px', padding: '20px', background: '#fff3f3', border: '1px solid #ffc1c1', borderRadius: '12px', color: '#d63031', fontSize: '13px' }}>
              <strong>ğŸ“Š í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:</strong> ${statsError}<br />
              (Vercelì˜ SUPABASE í™˜ê²½ ë³€ìˆ˜ ë° DB í…Œì´ë¸” ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.)
            </div>
          ) : (
            <div style={{ marginTop: '60px', textAlign: 'center', opacity: 0.5 }}>
              <p className="text-small">í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
          )}

          <div style={{ marginTop: '60px' }}>
            <h3 className="text-h2">ì „ì²´ ì‚¬ê³  ë¶„í¬</h3>
            <RadarChart data={results.allScores} />

            <div style={{ marginTop: '40px', textAlign: 'center', display: 'flex', flexDirection: 'column', gap: '12px' }}>
              <button
                onClick={() => history.push('/explore')}
                className="btn-secondary"
                style={{ width: '100%', padding: '16px' }}
              >
                ë‹¤ë¥¸ ì•„í‚¤íƒ€ì… ì „ì²´ ë³´ê¸°
              </button>
              <button
                onClick={() => {
                  if (confirm('ëª¨ë“  ì§„ë‹¨ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í• ê¹Œìš”?')) {
                    localStorage.clear();
                    window.location.hash = '#/';
                    window.location.reload();
                  }
                }}
                style={{ background: 'none', border: 'none', color: '#999', fontSize: '13px', cursor: 'pointer', textDecoration: 'underline' }}
              >
                ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Inject marked.js for Markdown parsing
    const script = document.createElement('script');
    script.src = "https://cdn.jsdelivr.net/npm/marked/marked.min.js";
    document.head.appendChild(script);

    const AnalysisSection = ({ primary, secondary, underUsed, allScores, rawAnswers }) => {
      const [status, setStatus] = useState('idle'); // idle, analyzing, done
      const [analysis, setAnalysis] = useState(null);

      const generateAnalysis = async () => {
        setStatus('analyzing');

        try {
          const response = await fetch('/api/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              primaryId: primary.id,
              secondaryId: secondary.id,
              underUsedIds: [underUsed.id],
              scores: allScores,
              rawAnswers: rawAnswers
            })
          });

          if (!response.ok) throw new Error('API request failed');

          const data = await response.json();
          if (data.error) throw new Error(data.error);

          // Clean the response: remove markdown code fences if present (e.g. ```html ... ```)
          let cleanText = data.analysis || "";
          cleanText = cleanText.replace(/```html/gi, "").replace(/```/g, "").trim();

          // Use marked.js if available, else fallback to raw text
          const htmlContent = window.marked ? window.marked.parse(cleanText) : cleanText;
          setAnalysis(htmlContent);
          setStatus('done');
        } catch (error) {
          console.error('AI Analysis Error:', error);
          // Fallback to rule-based analysis if AI fails
          const fallback = generateInterpretation(primary, secondary, underUsed);
          setAnalysis(`
            <div style="background:#fff3f3; padding:12px; border-radius:4px; border:1px solid #ffc1c1; color:#d63031; font-size:12px; margin-bottom:16px;">
              <strong>âš ï¸ AI ë¶„ì„ ì„œë²„ ì—°ê²° ì‹¤íŒ¨:</strong> ${error.message}<br/>
              (Vercelì˜ GEMINI_API_KEY ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”. í˜„ì¬ëŠ” ê·œì¹™ ê¸°ë°˜ ì—”ì§„ìœ¼ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.)
            </div>
            ${fallback}
          `);
          setStatus('done');
        }
      };

      if (status === 'idle') {
        return (
          <div style={{ background: '#EBEFFE', padding: '24px', borderRadius: '8px', textAlign: 'center' }}>
            <h3 className="text-h3" style={{ color: 'var(--color-accent)' }}>âœ¨ AI ë§ì¶¤í˜• ì¢…í•© í•´ì„</h3>
            <p className="text-small" style={{ marginBottom: '16px', color: '#555' }}>
              ë‹¹ì‹ ì˜ ì„±í–¥ ì¡°í•©ì„ ë¶„ì„í•˜ì—¬<br />ê°•ì ê³¼ ë³´ì™„ì ì„ í†µí•©ì ìœ¼ë¡œ í•´ì„í•´ ë“œë¦½ë‹ˆë‹¤.
            </p>
            <button
              onClick={generateAnalysis}
              style={{
                background: 'var(--color-accent)', color: '#fff', padding: '12px 24px',
                borderRadius: '4px', fontWeight: 600, fontSize: '14px', border: 'none', cursor: 'pointer'
              }}
            >
              ì¢…í•© ê²°ê³¼ ìƒì„±í•˜ê¸°
            </button>
          </div>
        );
      }

      if (status === 'analyzing') {
        return (
          <div style={{ background: '#F5F5F7', padding: '40px 20px', borderRadius: '8px', textAlign: 'center' }}>
            <div className="spinner"></div>
            <p className="text-small" style={{ marginTop: '16px', color: '#666' }}>
              AIê°€ ë‹¹ì‹ ì˜ ë¬¸ì œ í•´ê²° DNAë¥¼ ì‹¬ì¸µ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...<br />
              <span style={{ fontSize: '12px', color: '#999' }}>Gemini Pro ì•Œê³ ë¦¬ì¦˜ ê°€ë™ ì¤‘ (Vercel Secure Gate)</span>
            </p>
            <style>{`
      .spinner {
      width: 24px; height: 24px;
      border: 3px solid #ddd; border - top - color: var(--color - accent);
      borderRadius: 50 %; margin: 0 auto;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    `}</style>
          </div>
        );
      }

      return (
        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          style={{ background: '#fff', border: '1px solid #111', padding: '24px', borderRadius: '8px', position: 'relative', boxShadow: '0 4px 20px rgba(0,0,0,0.08)' }}
        >
          <div style={{ position: 'absolute', top: -12, left: 24, background: '#111', color: '#fff', padding: '4px 12px', fontSize: '12px', fontWeight: 700, borderRadius: '12px' }}>
            ê²°ê³¼ ì¢…í•©ë¶„ì„ (SECURE)
          </div>
          <h3 className="text-h2" style={{ marginTop: '16px' }}>ê²°ê³¼ ì¢…í•©ë¶„ì„</h3>
          <div className="analysis-content" style={{ fontSize: '15px', lineHeight: '1.7', marginTop: '16px' }} dangerouslySetInnerHTML={{ __html: analysis }}></div>
          <style>{`
            .analysis-content h1, .analysis-content h2, .analysis-content h3 { margin-top: 20px; font-size: 18px; color: var(--color-accent); }
            .analysis-content ul, .analysis-content ol { padding-left: 20px; margin: 12px 0; }
            .analysis-content p { margin-bottom: 12px; }
            .analysis-content strong { color: #111; }
          `}</style>
        </motion.div>
      );
    };

    const StatisticsSection = ({ stats, userPrimaryId }) => {
      const userPrimaryName = archetypes.find(a => a.id === userPrimaryId)?.name.split(' (')[0];
      const userPercent = stats.distribution[userPrimaryId] || 10;

      return (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          style={{ background: '#f8f9fa', padding: '32px', borderRadius: '16px', border: '1px solid #e9ecef' }}
        >
          <div style={{ textAlign: 'center', marginBottom: '32px' }}>
            <span style={{ fontSize: '12px', fontWeight: 700, color: 'var(--color-accent)', textTransform: 'uppercase', letterSpacing: '1px' }}>Global Trends</span>
            <h3 className="text-h2" style={{ marginTop: '8px', fontSize: '24px' }}>ì¸êµ¬í†µê³„ ë°ì´í„° ì¸ì‚¬ì´íŠ¸</h3>
          </div>

          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))', gap: '16px', marginBottom: '32px' }}>
            <div style={{ background: '#fff', padding: '20px', borderRadius: '12px', textAlign: 'center', boxShadow: '0 4px 12px rgba(0,0,0,0.03)' }}>
              <div style={{ fontSize: '28px', fontWeight: 800, color: 'var(--color-accent)' }}>{stats.totalParticipants.toLocaleString()}+</div>
              <div style={{ fontSize: '12px', color: '#666', marginTop: '4px' }}>ëˆ„ì  ì§„ë‹¨ ì°¸ì—¬ì</div>
            </div>
            <div style={{ background: '#fff', padding: '20px', borderRadius: '12px', textAlign: 'center', boxShadow: '0 4px 12px rgba(0,0,0,0.03)' }}>
              <div style={{ fontSize: '28px', fontWeight: 800, color: '#333' }}>{userPercent}%</div>
              <div style={{ fontSize: '12px', color: '#666', marginTop: '4px' }}>{userPrimaryName} ë¹„ìœ¨</div>
            </div>
          </div>

          <div style={{ background: 'rgba(69, 123, 157, 0.05)', padding: '24px', borderRadius: '12px', marginBottom: '32px' }}>
            <h4 style={{ fontSize: '14px', fontWeight: 700, color: '#444', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
              <span>ğŸ’¡</span> í¥ë¯¸ë¡œìš´ ë°œê²¬ (Market Insights)
            </h4>
            <ul style={{ listStyle: 'none', padding: 0, margin: 0 }}>
              {stats.synergyInsights.map(insight => (
                <li key={insight.id} style={{ fontSize: '14px', color: '#555', marginBottom: '12px', display: 'flex', gap: '8px' }}>
                  <span style={{ color: 'var(--color-accent)' }}>â€¢</span>
                  {insight.text}
                </li>
              ))}
            </ul>
          </div>

          <div style={{ textAlign: 'center' }}>
            <p style={{ fontSize: '13px', color: '#888', fontStyle: 'italic' }}>
              "ë‹¹ì‹ ì€ {userPrimaryName} ìœ í˜•ì„ ì£¼ ë„êµ¬ë¡œ ì‚¬ìš©í•˜ëŠ” <strong style={{ color: 'var(--color-accent)' }}>ìƒìœ„ {userPercent}%</strong>ì˜ ë¬¸ì œ í•´ê²°ì‚¬ì…ë‹ˆë‹¤."
            </p>
          </div>
        </motion.div>
      );
    };

    const ExplorePage = () => {
      const history = useHistory();
      const [selectedId, setSelectedId] = useState(null);

      const renderList = () => (
        <div style={{ padding: '20px 0 40px 0', background: 'linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%)', minHeight: '100vh' }}>
          <div style={{ textAlign: 'center', marginBottom: '40px' }}>
            <h2 className="text-h2" style={{ fontSize: '26px', marginBottom: '12px' }}>ëª¨ë“  ì•„í‚¤íƒ€ì… íƒìƒ‰</h2>
            <p className="text-body" style={{ color: '#666', fontSize: '15px' }}>10ê°€ì§€ ë¬¸ì œì •ì˜ ì‚¬ê³ ë°©ì‹ì„ íƒìƒ‰í•´ë³´ì„¸ìš”</p>
          </div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: '20px' }}>
            {archetypes.map(a => (
              <motion.div
                key={a.id}
                onClick={() => setSelectedId(a.id)}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                whileHover={{ y: -4 }}
                style={{
                  padding: '24px',
                  background: '#fff',
                  borderRadius: '16px',
                  border: '1px solid #e8e8e8',
                  cursor: 'pointer',
                  transition: 'all 0.3s',
                  boxShadow: '0 2px 8px rgba(0,0,0,0.04)'
                }}
                onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 8px 24px rgba(0,0,0,0.12)'; e.currentTarget.style.borderColor = 'var(--color-accent)'; }}
                onMouseLeave={(e) => { e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.04)'; e.currentTarget.style.borderColor = '#e8e8e8'; }}
              >
                <div style={{ fontSize: '36px', marginBottom: '16px', textAlign: 'center' }}>{archetypeIcons[a.id] || 'ğŸ“Œ'}</div>
                <div style={{ fontSize: '18px', fontWeight: 700, color: '#111', marginBottom: '12px', textAlign: 'center' }}>{a.name.split(' (')[0]}</div>
                <div style={{ fontSize: '14px', color: '#666', lineHeight: 1.5, textAlign: 'center' }}>{a.oneLiner}</div>
              </motion.div>
            ))}
          </div>
          <button
            className="btn-secondary"
            style={{
              marginTop: '48px',
              width: '100%',
              maxWidth: '400px',
              margin: '48px auto 0',
              display: 'block',
              padding: '16px',
              borderRadius: '12px'
            }}
            onClick={() => history.goBack()}
          >
            â† ë‚´ ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      );

      const renderDetail = () => {
        const arch = archetypes.find(a => a.id === selectedId);
        return (
          <motion.div
            initial={{ opacity: 0, x: 20 }}
            animate={{ opacity: 1, x: 0 }}
            exit={{ opacity: 0, x: -20 }}
            style={{ paddingBottom: '40px' }}
          >
            <button
              onClick={() => setSelectedId(null)}
              style={{ background: 'none', border: 'none', fontSize: '14px', color: '#666', cursor: 'pointer', marginBottom: '16px', display: 'flex', alignItems: 'center' }}
            >
              â† ëª©ë¡ìœ¼ë¡œ
            </button>
            <h2 className="text-h1" style={{ marginBottom: '8px', color: 'var(--color-accent)' }}>{arch.name}</h2>
            <p className="text-h3" style={{ marginBottom: '32px', color: '#555' }}>{arch.oneLiner}</p>

            <div dangerouslySetInnerHTML={{ __html: arch.fullContent }} />

            <div style={{ marginTop: '60px', paddingTop: '20px', borderTop: '1px solid #eee' }}>
              <button className="btn-secondary" style={{ width: '100%' }} onClick={() => history.goBack()}>
                ë‚´ ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°
              </button>
            </div>
          </motion.div>
        );
      };

      return (
        <div className="container" style={{ paddingTop: '40px' }}>
          {selectedId ? renderDetail() : renderList()}
        </div>
      );
    };

    const LimitationsPage = () => {
      const history = useHistory();
      return (
        <div className="container" style={{ paddingTop: '60px', paddingBottom: '60px' }}>
          <h1 className="text-h1" style={{ marginBottom: '40px' }}>ìœ ì˜ì‚¬í•­ ë° í•œê³„ì </h1>

          <div className="text-body" style={{ background: '#F9FAFB', padding: '32px', borderRadius: '12px' }}>
            <h3 className="text-h2" style={{ marginBottom: '16px' }}>â€œì•„í‚¤íƒ€ì…ì€ ê°ì˜¥ì´ ì•„ë‹ˆë¼ ë„êµ¬ì…ë‹ˆë‹¤â€</h3>
            <p>ì§„ë‹¨ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê¸° ì „, ë‹¤ìŒì˜ ì‚¬í•­ë“¤ì„ ë°˜ë“œì‹œ ìˆ™ì§€í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ë³¸ ì•„í‚¤íƒ€ì… ëª¨ë¸ì˜ ëª©ì ì€ ê°œì¸ì„ ë¶„ë¥˜í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ <strong>ì‚¬ê³ ì˜ í™•ì¥ì„ ë•ëŠ” ê²ƒ</strong>ì…ë‹ˆë‹¤.</p>

            <br />
            <h4 className="text-h3">1. ê³ ì°©ëœ ì„±ê²©ì´ ì•„ë‹Œ â€˜í˜„ì¬ì˜ ìƒíƒœâ€™ì…ë‹ˆë‹¤.</h4>
            <p>ì•„í‚¤íƒ€ì…ì€ ê³ ì •ëœ ì§€ëŠ¥ì´ ì•„ë‹™ë‹ˆë‹¤. ë‹¹ì‹ ì´ ì†í•œ íŒ€ì˜ ì„±ê²©, í˜„ì¬ ìˆ˜í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ì˜ ë‹¨ê³„, í˜¹ì€ ë‹¹ì‹ ì˜ ì§ë¬´ì— ë”°ë¼ ì£¼ëœ ì•„í‚¤íƒ€ì…ì€ ì–¸ì œë“  ë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²°ê³¼ì— ìŠ¤ìŠ¤ë¡œë¥¼ ê°€ë‘ì§€ ë§ˆì‹­ì‹œì˜¤.</p>

            <br />
            <h4 className="text-h3">2. ëª¨ë“  ì•„í‚¤íƒ€ì…ì—ëŠ” â€˜ì§€ì  ê·¸ë¦¼ìâ€™ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</h4>
            <p>ê°•ì ì´ ê°•í• ìˆ˜ë¡ ê·¸ ì´ë©´ì˜ ì•½ì ë„ ëšœë ·í•´ì§‘ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ â€˜íƒì •â€™ì˜ ë‚ ì¹´ë¡œìš´ ë¶„ì„ë ¥ì€ â€˜ë¶„ì„ ë§ˆë¹„â€™ë¥¼ ì•¼ê¸°í•  ìˆ˜ ìˆê³ , â€˜íŒì‚¬â€™ì˜ ê²°ë‹¨ë ¥ì€ â€˜ë…ë‹¨â€™ìœ¼ë¡œ íë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì‹ ì˜ ì•„í‚¤íƒ€ì…ì´ ê°€ì§„ ê·¸ë¦¼ìë¥¼ ì¸ì§€í•˜ëŠ” ê²ƒì´ ì„±ì¥ì˜ í•µì‹¬ì…ë‹ˆë‹¤.</p>

            <br />
            <h4 className="text-h3">3. â€˜ë‚˜ìœ ê²°ê³¼â€™ëŠ” ì—†ìŠµë‹ˆë‹¤. â€˜ëˆ„ë½ëœ ê´€ì â€™ë§Œ ìˆì„ ë¿ì…ë‹ˆë‹¤.</h4>
            <p>ë‚®ì€ ì ìˆ˜ê°€ ë‚˜ì˜¨ ì•„í‚¤íƒ€ì…ì€ ë‹¹ì‹ ì˜ ëŠ¥ë ¥ì´ ë¶€ì¡±í•¨ì„ ëœ»í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë¬¸ì œì •ì˜ ê³¼ì •ì—ì„œ ë‹¹ì‹ ì´ ìƒëŒ€ì ìœ¼ë¡œ ëœ ì¤‘ìš”í•˜ê²Œ ìƒê°í–ˆë˜ ì˜ì—­ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. í›Œë¥­í•œ íŒ€ì€ ì„œë¡œì˜ ë¶€ì¡±í•œ ì•„í‚¤íƒ€ì…ì„ ë³´ì™„í•´ ì¤„ ë•Œ ì™„ì„±ë©ë‹ˆë‹¤.</p>

            <br />
            <h4 className="text-h3">4. ê´€ì°°ì—ì„œ ë©ˆì¶”ì§€ ë§ê³  â€˜í–‰ë™â€™ìœ¼ë¡œ ì—°ê²°í•˜ì‹­ì‹œì˜¤.</h4>
            <p>ì´ í…ŒìŠ¤íŠ¸ì˜ ëª©ì ì€ ë‹¹ì‹ ì˜ ì„±í–¥ì„ ì•„ëŠ” ê²ƒì— ê·¸ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì•„í‚¤íƒ€ì…ì´ ê°€ì§„ ê°•ì ì„ íŒ€ì˜ ì „ëµìœ¼ë¡œ ì¹˜í™˜í•˜ê³ , ëˆ„ë½ëœ ì•„í‚¤íƒ€ì…ì˜ ì§ˆë¬¸ì„ ì˜ë„ì ìœ¼ë¡œ ë˜ì§ìœ¼ë¡œì¨ <strong>â€˜ë¬¸ì œì •ì˜ì˜ ìˆ˜ì¤€â€™</strong>ì„ ë†’ì´ëŠ” ë° ëª©ì ì´ ìˆìŠµë‹ˆë‹¤.</p>
          </div>

          <button className="btn-primary" style={{ marginTop: '40px', width: '100%' }} onClick={() => history.goBack()}>
            í™•ì¸í–ˆìŠµë‹ˆë‹¤
          </button>
        </div>
      );
    };

    // --- LOGIC: Rule-based Interpretation Engine ---
    const generateInterpretation = (p, s, u) => {
      // 1. Core Identity
      let text = `ë‹¹ì‹ ì€ <strong>${p.name.split(' (')[0]}</strong>ì˜ ì„±í–¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¸ìƒì„ ë°”ë¼ë´…ë‹ˆë‹¤. `;

      // 2. Combination Logic (Primary + Secondary)
      const isAnalytic = ['Engineer', 'Scientist', 'Economist', 'Detective', 'Cartographer'].includes(p.id);
      const isEmpathic = ['Anthropologist', 'Journalist'].includes(p.id);

      if (p.id === s.id) {
        text += `íŠ¹íˆ í•œ ê°€ì§€ ì‚¬ê³ ë°©ì‹ì´ ì••ë„ì ìœ¼ë¡œ ë°œë‹¬í•´ ìˆì–´, í•´ë‹¹ ë¶„ì•¼ì˜ ì „ë¬¸ê°€ì  í†µì°°ì„ ë³´ì—¬ì£¼ì§€ë§Œ ë•Œë¡œëŠ” ì‹œì•¼ê°€ ì¢ì•„ì§ˆ ìˆ˜ ìˆìŒì„ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.<br /><br />`;
      } else {
        text += `ë™ì‹œì— <strong>${s.name.split(' (')[0]}</strong>ì˜ ê¸°ì§ˆì„ ë³´ì¡° ë¬´ê¸°ë¡œ í™œìš©í•˜ì—¬ ê· í˜•ì„ ì¡ê³  ìˆêµ°ìš”.<br /><br />`;
      }

      // 3. Synergy Sentence
      text += `<strong>ğŸ’¡ ê°•ì ì˜ ê²°í•©</strong> <br />`;
      text += `ë‹¹ì‹ ì€ ${p.coreQuestion}ë¼ê³  ë¬»ëŠ” ë³¸ëŠ¥ì ì¸ ê°ê°ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ë¥¼ í•´ê²°í•˜ëŠ” ê³¼ì •ì—ì„œ ${s.coreQuestion.replace('â€œ', '').replace('â€', '')}ë¼ëŠ” ì§ˆë¬¸ì„ ë”í•´ ë¬¸ì œë¥¼ ì…ì²´ì ìœ¼ë¡œ íŒŒì•…í•©ë‹ˆë‹¤. `;

      if (isAnalytic && ['Anthropologist', 'Journalist'].includes(s.id)) {
        text += `ë…¼ë¦¬ì ì¸ ë¶„ì„ë ¥ì— ì‚¬ëŒì— ëŒ€í•œ ì´í•´ê°€ ë”í•´ì ¸, 'ì°¨ê°€ìš´ ì´ì„±'ê³¼ 'ë”°ëœ»í•œ ê³µê°'ì„ ë™ì‹œì— ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ì ì¬ë ¥ì´ ìˆìŠµë‹ˆë‹¤. `;
      } else if (isEmpathic && ['Scientist', 'Economist', 'Systems Thinker'].includes(s.id)) {
        text += `ì‚¬ëŒì— ëŒ€í•œ ê¹Šì€ ê³µê°ì„ ë°”íƒ•ìœ¼ë¡œ í•˜ë˜, ì´ë¥¼ í˜„ì‹¤ì ì¸ ì‹œìŠ¤í…œì´ë‚˜ ìˆ«ìë¡œ ì¦ëª…í•´ë‚´ëŠ” íƒì›”í•œ ì„¤ë“ë ¥ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `;
      } else {
        text += `ì´ ë‘ ê°€ì§€ ì§ˆë¬¸ì˜ ì¡°í•©ì€ ë¬¸ì œì˜ ë³¸ì§ˆì„ ëš«ê³  ì§€ë‚˜ê°€ëŠ” ê°•ë ¥í•œ ì†¡ê³³ê³¼ ê°™ìŠµë‹ˆë‹¤. `;
      }
      text += `<br /><br />`;

      // 4. Shadow/Blindspot Warning
      text += `<strong>âš ï¸ ì£¼ì˜í•  ì (Shadow)</strong> <br />`;
      text += `ë°˜ë©´, <strong>${u.name.split(' (')[0]}</strong> ì„±í–¥ì´ ê°€ì¥ ë‚®ê²Œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤. `;
      text += `ì´ëŠ” ë‹¹ì‹ ì´ ë¬¸ì œ í•´ê²° ê³¼ì •ì—ì„œ "${u.coreQuestion.replace('â€œ', '').replace('â€', '')}"ë¼ëŠ” ì§ˆë¬¸ì„ ë†“ì¹˜ê¸° ì‰½ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.<br /> `;

      const shadowRisks = {
        'Anthropologist': 'ì‚¬ìš©ìì˜ ì‹¤ì œ í–‰ë™ì„ ê´€ì°°í•˜ì§€ ì•Šê³  ì±…ìƒ ìœ„ì—ì„œë§Œ ê³ ë¯¼í•˜ë‹¤ê°€, ì•„ë¬´ë„ ì›í•˜ì§€ ì•ŠëŠ” í•´ê²°ì±…ì„ ë§Œë“¤ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.',
        'Journalist': 'íŒ€ ë‚´ë¶€ì˜ ë…¼ë¦¬ì—ë§Œ ê°‡í˜€, ì‹¤ì œ ì´í•´ê´€ê³„ìë“¤ì˜ ë‹¤ì–‘í•œ ëª©ì†Œë¦¬ë¥¼ ë“£ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'Scientist': 'ì§ê´€ì—ë§Œ ì˜ì¡´í•˜ì—¬ "ë‚´ ëŠë‚Œì´ ë§ì•„"ë¼ê³  ìš°ê¸°ë‹¤ê°€, ê°ê´€ì ì¸ ê²€ì¦ ê¸°íšŒë¥¼ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'Economist': 'ë©‹ì§„ ì•„ì´ë””ì–´ì— ì·¨í•´ ë¹„ìš©ê³¼ í˜„ì‹¤ì ì¸ ì œì•½ ì¡°ê±´ì„ ë¬´ì‹œí•˜ë‹¤ê°€ í”„ë¡œì íŠ¸ë¥¼ ì¤‘ë‹¨ì‹œí‚¬ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.',
        'Cartographer': 'ë¬¸ì œì˜ ë²”ìœ„ë¥¼ ì •í•˜ì§€ ëª»í•´ ëª¨ë“  ê²ƒì„ ë‹¤ í•´ê²°í•˜ë ¤ë‹¤ ì—ë„ˆì§€ê°€ ë¶„ì‚°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'Detective': 'í˜„ìƒë§Œ ìˆ˜ìŠµí•˜ë ¤ë‹¤ ì§„ì§œ ì›ì¸ì„ ë†“ì³, ê°™ì€ ë¬¸ì œê°€ ë°˜ë³µí•´ì„œ í„°ì§€ëŠ” ìƒí™©ì„ ê²ªì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'Systems Thinker': 'ë‹¹ì¥ì˜ ë¬¸ì œ í•´ê²°ì—ë§Œ ê¸‰ê¸‰í•´, ê·¸ í•´ê²°ì±…ì´ ë¶ˆëŸ¬ì˜¬ ë‹¤ë¥¸ ë¶€ì‘ìš©ì„ ì˜ˆì¸¡í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'Philosopher': 'ë°©ë²•ë¡ ì—ë§Œ ë§¤ëª°ë˜ì–´ "ê·¼ë³¸ì ìœ¼ë¡œ ì´ê²ƒì´ ì™œ í•„ìš”í•œê°€"í•˜ëŠ” ê°€ì¹˜ íŒë‹¨ì„ ì†Œí™€íˆ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'Judges': 'ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ì§€ ëª»í•´ ëª¨ë“  ìš”ì²­ì„ ë‹¤ ë“¤ì–´ì£¼ë ¤ë‹¤ í”„ë¡œì íŠ¸ì˜ ë°©í–¥ì„±ì„ ìƒì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        'Scenario Planner': 'ë‹¹ì¥ì˜ ì„±ê³¼ì—ë§Œ ì§‘ì¤‘í•´, ë¯¸ë˜ì— ë‹¥ì³ì˜¬ ë¦¬ìŠ¤í¬ë¥¼ ëŒ€ë¹„í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
      };

      text += `${shadowRisks[u.id] || ''}<br/><br/>`;

      // 5. Final Advice
      text += `<strong>ğŸš€ Action Plan</strong> <br />`;
      text += `ë‹¤ìŒ íšŒì˜ì—ì„œëŠ” ì˜ì‹ì ìœ¼ë¡œ <strong>"${u.coreQuestion.replace('â€œ', '').replace('â€', '')}"</strong> ë¼ëŠ” ì§ˆë¬¸ì„ ë¨¼ì € ë˜ì ¸ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ ê°•ë ¥í•œ ì£¼ ë¬´ê¸°ì— ì´ ì§ˆë¬¸ì´ ë”í•´ì§ˆ ë•Œ, ë¹„ë¡œì†Œ ì™„ì „í•œ ë¬¸ì œì •ì˜ê°€ ì™„ì„±ë  ê²ƒì…ë‹ˆë‹¤.`;

      return text;
    };

    const AnimatedRoutes = () => {
      const location = useLocation();
      return (
        <AnimatePresence mode="wait">
          <Switch location={location} key={location.pathname}>
            <Route exact path="/" component={LandingPage} />
            <Route path="/intro" component={IntroPage} />
            <Route path="/test" component={TestPage} />
            <Route path="/result" component={ResultPage} />
            <Route path="/explore" component={ExplorePage} />
            <Route path="/limitations" component={LimitationsPage} />
          </Switch>
        </AnimatePresence>
      );
    };

    const App = () => {
      return (
        <HashRouter>
          <div className="app-container">
            <AnimatedRoutes />
          </div>
        </HashRouter>
      );
    };

    const root = document.getElementById('root');
    ReactDOM.render(<App />, root);
  </script>
</body>

</html>